trigger: none

variables:
  - group: variable-group-taller
  - name: environmentPath
    value: 'terraform/environments/$(environment)'
  - name: aksResourceGroup
    value: 'dev-resource-group'
  - name: aksClusterName
    value: 'dev-aks-cluster'
  - name: kubernetesNamespace
    value: 'ecommerce'
  - name: nginxServiceName
    value: 'nginx'

stages:

# -----------------------------
# UNIT & INTEGRATION TESTS
# -----------------------------
- stage: Tests
  displayName: 'Run Unit and Integration Tests'
  jobs:
  - job: RunTests
    pool:
      vmImage: 'windows-latest'
    steps:
    - checkout: self
    - task: PowerShell@2
      displayName: 'Run Unit and Integration Tests'
      inputs:
        targetType: 'inline'
        script: |
          Write-Host "üèÉ Running Unit Tests"
          cd user-service
          .\mvnw.cmd test -Dtest=*ApplicationTests*
          
          Write-Host "üèÉ Running Integration Tests"
          .\mvnw.cmd test -Dtest=*ResourceIntegrationTest

    - task: PublishTestResults@2
      inputs:
        testResultsFiles: '**/surefire-reports/*.xml'
        testRunTitle: 'Unit and Integration Tests'

